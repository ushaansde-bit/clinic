<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | Shree Physiotherapy Clinic</title>

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#1B4D3E">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Physio Dashboard">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-152x152.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=DM+Sans:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/dashboard-calendar.css">
</head>
<body>

  <!-- Browser Compatibility Notice -->
  <script>
  (function() {
      var isIE = !!window.MSInputMethodContext || !!document.documentMode || (navigator.userAgent.indexOf('MSIE') !== -1) || (navigator.userAgent.indexOf('Trident/') !== -1);
      if (isIE) {
          var d = document.createElement('div');
          d.style.cssText = 'position:fixed;top:0;left:0;right:0;z-index:99999;background:#F59E0B;color:#000;padding:12px 20px;text-align:center;font-family:Arial,sans-serif;font-size:14px;line-height:1.5;box-shadow:0 2px 8px rgba(0,0,0,0.2);';
          d.innerHTML = '<strong>Internet Explorer is outdated.</strong> For the best experience, please switch to <a href="https://www.microsoft.com/edge" style="color:#1B4D3E;text-decoration:underline;font-weight:bold;">Microsoft Edge</a>, <a href="https://www.google.com/chrome/" style="color:#1B4D3E;text-decoration:underline;font-weight:bold;">Google Chrome</a>, or <a href="https://www.mozilla.org/firefox/" style="color:#1B4D3E;text-decoration:underline;font-weight:bold;">Mozilla Firefox</a>. <button onclick="this.parentNode.remove()" style="margin-left:12px;background:none;border:1px solid #000;padding:2px 10px;cursor:pointer;border-radius:4px;">Dismiss</button>';
          document.body.insertBefore(d, document.body.firstChild);
      }
  })();
  </script>

  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <!-- Setup Card (first time) -->
    <div class="login-card" id="setupCard" style="display:none;">
      <div style="width:72px;height:72px;background:rgba(27,77,62,0.08);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;">
        <i class="fas fa-plus" style="font-size:1.8rem;color:var(--primary);"></i>
      </div>
      <h2>Set Up Login</h2>
      <p class="login-subtitle">Create your username and password to secure the dashboard.</p>
      <form onsubmit="handleSetup(event)">
        <div class="form-group">
          <label for="setupUsername">Choose Username</label>
          <input type="text" id="setupUsername" placeholder="Enter a username" required minlength="3" autocomplete="username">
        </div>
        <div class="form-group">
          <label for="setupPassword">Choose Password</label>
          <input type="password" id="setupPassword" placeholder="Enter a password" required minlength="4" autocomplete="new-password">
        </div>
        <div class="form-group">
          <label for="setupConfirm">Confirm Password</label>
          <input type="password" id="setupConfirm" placeholder="Re-enter password" required minlength="4" autocomplete="new-password">
        </div>
        <p class="login-error" id="setupError">Passwords do not match.</p>
        <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center;margin-top:8px;">
          <i class="fas fa-check-circle"></i> Create Account
        </button>
      </form>
    </div>

    <!-- Login Card (returning user) -->
    <div class="login-card" id="loginCard" style="display:none;">
      <div style="width:72px;height:72px;background:rgba(27,77,62,0.08);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;">
        <i class="fas fa-plus" style="font-size:1.8rem;color:var(--primary);"></i>
      </div>
      <h2>Doctor Login</h2>
      <p class="login-subtitle">Shree Physiotherapy Clinic</p>
      <p class="login-error" id="loginError">Invalid username or password.</p>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="loginUsername">Username</label>
          <input type="text" id="loginUsername" placeholder="Enter username" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <input type="password" id="loginPassword" placeholder="Enter password" required autocomplete="current-password">
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center;margin-top:8px;">
          <i class="fas fa-sign-in-alt"></i> Login
        </button>
      </form>
      <p style="margin-top:16px;text-align:center;">
        <a href="#" onclick="forgotPassword(); return false;" style="font-size:0.82rem;color:var(--primary);text-decoration:none;font-weight:500;">Forgot Password?</a>
      </p>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboardApp" style="display:none;">

    <nav class="navbar dashboard-nav" id="navbar">
      <div class="container nav-container">
        <a href="index.html" class="nav-brand">
          <span class="brand-logo"></span>
          <div class="brand-text">
            <span class="brand-name">Dr. Aarthi Ganesh</span>
            <span class="brand-subtitle">Shree Physiotherapy Clinic</span>
          </div>
        </a>
        <div class="nav-right">
          <ul class="nav-menu" id="navMenu">
            <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
            <li class="nav-item"><a href="index.html#services" class="nav-link">Services</a></li>
            <li class="nav-item"><a href="index.html#contact" class="nav-link">Contact</a></li>
          </ul>
          <button onclick="logoutDashboard()" class="btn-logout" title="Logout">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </nav>

    <div class="dashboard-layout">
      <aside class="sidebar">
        <div class="sidebar-header">
          <h3><i class="fas fa-stethoscope"></i> Dashboard</h3>
        </div>
        <nav class="sidebar-nav">
          <a href="#" class="active" onclick="switchTab('overview'); return false;">
            <span class="nav-icon"><i class="fas fa-chart-line"></i></span> Overview
          </a>
          <a href="#" onclick="switchTab('patients'); return false;">
            <span class="nav-icon"><i class="fas fa-users"></i></span> Patients
          </a>
          <a href="#" onclick="switchTab('appointments'); return false;">
            <span class="nav-icon"><i class="fas fa-calendar-check"></i></span> Appointments
          </a>
          <a href="#" onclick="switchTab('calendar'); return false;">
            <span class="nav-icon"><i class="fas fa-calendar"></i></span> Calendar View
          </a>
          <a href="#" onclick="switchTab('accounts'); return false;">
            <span class="nav-icon"><i class="fas fa-book"></i></span> Accounts
          </a>
          <a href="#" onclick="switchTab('settings'); return false;">
            <span class="nav-icon"><i class="fas fa-cloud"></i></span> Cloud Sync
            <span id="syncStatusIndicator" style="margin-left:auto;font-size:0.75rem;"></span>
          </a>
          <a href="#" onclick="switchTab('trash'); return false;" style="margin-top:auto;border-top:1px solid var(--border-light);padding-top:12px;">
            <span class="nav-icon"><i class="fas fa-trash-alt"></i></span> Trash
            <span class="trash-count" id="trashCount" style="display:none;"></span>
          </a>
        </nav>
      </aside>

      <main class="dashboard-main">
        <!-- Mobile Tab Nav -->
        <div class="mobile-tab-nav" id="mobileTabNav">
          <button class="active" onclick="switchTab('overview')">Overview</button>
          <button onclick="switchTab('patients')">Patients</button>
          <button onclick="switchTab('appointments')">Appointments</button>
          <button onclick="switchTab('calendar')">Calendar</button>
          <button onclick="switchTab('accounts')">Accounts</button>
          <button onclick="switchTab('settings')">Sync</button>
          <button onclick="switchTab('trash')">Trash</button>
        </div>

        <!-- TAB: Overview -->
        <div id="tab-overview" class="tab-content">
          <!-- Overdue Alert -->
          <div id="overdueAlert" style="display:none;margin-bottom:16px;"></div>

          <!-- Welcome Header -->
          <div class="overview-welcome">
            <div class="welcome-text">
              <h1>Welcome back, <span id="welcomeName">Doctor</span></h1>
              <p id="welcomeDate">Loading...</p>
            </div>
            <div class="quick-actions">
              <button class="quick-action-btn" onclick="switchTab('patients');openModal('addPatientModal');">
                <i class="fas fa-user-plus"></i> New Patient
              </button>
              <button class="quick-action-btn primary" onclick="switchTab('calendar');">
                <i class="fas fa-calendar-plus"></i> Book Appointment
              </button>
            </div>
          </div>

          <!-- Stats Cards (5 items) -->
          <div class="overview-stats-grid">
            <div class="stat-card-modern patients" onclick="switchTab('patients')" style="cursor:pointer;" title="View Patients">
              <div class="stat-card-icon"><i class="fas fa-users"></i></div>
              <div class="stat-card-content">
                <span class="stat-number" id="statPatients">0</span>
                <span class="stat-label">Total Patients</span>
              </div>
            </div>
            <div class="stat-card-modern today" onclick="switchTab('appointments')" style="cursor:pointer;" title="View Appointments">
              <div class="stat-card-icon"><i class="fas fa-calendar-check"></i></div>
              <div class="stat-card-content">
                <span class="stat-number" id="statToday">0</span>
                <span class="stat-label">Today's Appointments</span>
              </div>
            </div>
            <div class="stat-card-modern week" onclick="switchTab('calendar')" style="cursor:pointer;" title="View Calendar">
              <div class="stat-card-icon"><i class="fas fa-calendar-week"></i></div>
              <div class="stat-card-content">
                <span class="stat-number" id="statWeek">0</span>
                <span class="stat-label">This Week</span>
              </div>
            </div>
            <div class="stat-card-modern" style="--stat-accent:#8B5CF6;">
              <div class="stat-card-icon" style="background:rgba(139,92,246,0.1);color:#8B5CF6;"><i class="fas fa-file-prescription"></i></div>
              <div class="stat-card-content">
                <span class="stat-number" id="statPrescriptions">0</span>
                <span class="stat-label">Prescriptions</span>
              </div>
            </div>
            <div class="stat-card-modern" style="--stat-accent:#F59E0B;">
              <div class="stat-card-icon" style="background:rgba(245,158,11,0.1);color:#F59E0B;"><i class="fas fa-bell"></i></div>
              <div class="stat-card-content">
                <span class="stat-number" id="statFollowups">0</span>
                <span class="stat-label">Pending Follow-ups</span>
              </div>
            </div>
          </div>

          <!-- Main Content Grid - Business Insights -->
          <div class="overview-main-grid">
            <!-- Weekly Appointments Chart -->
            <div class="overview-card">
              <div class="overview-card-header">
                <h3><i class="fas fa-chart-bar"></i> This Week's Activity</h3>
                <span class="card-badge" id="weeklyTotal">0</span>
              </div>
              <div class="overview-card-body">
                <div class="weekly-chart-container" id="weeklyChartContainer"></div>
                <div class="chart-legend">
                  <span class="legend-item"><span class="legend-color completed"></span> Completed</span>
                  <span class="legend-item"><span class="legend-color scheduled"></span> Scheduled</span>
                </div>
              </div>
            </div>

            <!-- New Patients & Completion Rate (moved from growth metrics) -->
            <div class="overview-card">
              <div class="overview-card-header">
                <h3><i class="fas fa-chart-pie"></i> Growth &amp; Performance</h3>
              </div>
              <div class="overview-card-body" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;padding:20px;">
                <!-- New Patients -->
                <div style="text-align:center;">
                  <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:8px;"><i class="fas fa-user-plus" style="margin-right:4px;"></i> New Patients</div>
                  <div style="font-size:2rem;font-weight:700;color:var(--text);" id="newPatientsThisMonth">0</div>
                  <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">This Month</div>
                  <div class="growth-comparison" id="patientGrowthComparison" style="justify-content:center;margin-top:8px;">
                    <i class="fas fa-arrow-up"></i>
                    <span>+0% vs last month</span>
                  </div>
                </div>
                <!-- Completion Rate -->
                <div style="text-align:center;">
                  <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:8px;"><i class="fas fa-check-circle" style="margin-right:4px;"></i> Completion Rate</div>
                  <div class="completion-ring-container">
                    <div class="completion-ring" id="completionRing">
                      <svg viewBox="0 0 36 36">
                        <path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                        <path class="ring-fill" id="completionRingFill" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                      </svg>
                      <span class="ring-text" id="completionRate">0%</span>
                    </div>
                  </div>
                  <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">This Week</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Growth Metrics Grid (3 items) -->
          <div class="growth-metrics-grid">
            <!-- Revenue Trend (moved from main grid) -->
            <div class="growth-card">
              <div class="growth-card-header">
                <i class="fas fa-chart-line"></i>
                <span>Revenue Trend</span>
              </div>
              <div class="growth-card-body">
                <span class="card-badge revenue-badge" id="monthlyRevenue" style="display:inline-block;margin-bottom:8px;">₹0</span>
                <div class="revenue-chart-container" id="revenueChartContainer" style="height:100px;"></div>
              </div>
            </div>

            <!-- Today's Revenue (moved from stat cards) -->
            <div class="growth-card">
              <div class="growth-card-header">
                <i class="fas fa-indian-rupee-sign"></i>
                <span>Today's Revenue</span>
              </div>
              <div class="growth-card-body">
                <div class="growth-stat">
                  <span class="growth-number">₹<span id="statRevenue">0</span></span>
                  <span class="growth-period">Today</span>
                </div>
              </div>
            </div>

            <!-- Monthly Revenue -->
            <div class="growth-card highlight">
              <div class="growth-card-header">
                <i class="fas fa-indian-rupee-sign"></i>
                <span>Monthly Revenue</span>
              </div>
              <div class="growth-card-body">
                <div class="growth-stat">
                  <span class="growth-number" id="totalMonthlyRevenue">₹0</span>
                  <span class="growth-period" id="currentMonthName">This Month</span>
                </div>
                <div class="growth-comparison" id="revenueGrowthComparison">
                  <i class="fas fa-arrow-up"></i>
                  <span>+0% vs last month</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: Patients -->
        <div id="tab-patients" class="tab-content" style="display:none;">
          <div class="dashboard-card-header" style="margin-bottom:24px;">
            <h2 style="font-size:1.8rem;">Patient Records</h2>
            <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
              <div class="search-input">
                <i class="fas fa-search" style="color:var(--text-muted);"></i>
                <input type="text" id="patientSearch" placeholder="Search patients...">
              </div>
              <input type="date" id="patientDateFilter" onchange="filterPatients()" style="padding:8px 14px;border:1px solid var(--border);border-radius:var(--radius);font-family:var(--font-body);font-size:0.88rem;background:var(--surface);">
              <select id="patientStatusFilter" onchange="filterPatients()" style="padding:8px 14px;border:1px solid var(--border);border-radius:var(--radius);font-family:var(--font-body);font-size:0.88rem;background:var(--surface);">
                <option value="all">All Patients</option>
                <option value="today">Visited Today</option>
                <option value="upcoming">Has Upcoming Appointment</option>
                <option value="completed">Completed Treatment</option>
                <option value="pending">Pending Follow-up</option>
              </select>
              <button class="btn btn-primary" onclick="openModal('addPatientModal')" style="padding:8px 16px;font-size:0.85rem;">
                <i class="fas fa-plus"></i> Add Patient
              </button>
              <button class="btn btn-outline" onclick="clearPatientFilters()" style="padding:8px 16px;font-size:0.85rem;">
                <i class="fas fa-times"></i> Clear
              </button>
            </div>
          </div>
          <div class="dashboard-card">
            <div style="overflow-x:auto;">
              <table class="data-table" id="patientsTable">
                <thead><tr><th>Name</th><th>Age</th><th>Gender</th><th>Phone</th><th>Visits</th><th>Last Visit</th><th>Actions</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- TAB: Appointments -->
        <div id="tab-appointments" class="tab-content" style="display:none;">
          <div class="dashboard-card-header" style="margin-bottom:24px;">
            <h2 style="font-size:1.8rem;">Appointments</h2>
            <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
              <div class="search-input">
                <i class="fas fa-search" style="color:var(--text-muted);"></i>
                <input type="text" id="appointmentSearch" placeholder="Search patients...">
              </div>
              <input type="date" id="appointmentFilter" style="padding:8px 14px;border:1px solid var(--border);border-radius:var(--radius);font-family:var(--font-body);font-size:0.88rem;background:var(--surface);">
              <select id="appointmentStatusFilter" style="padding:8px 14px;border:1px solid var(--border);border-radius:var(--radius);font-family:var(--font-body);font-size:0.88rem;background:var(--surface);">
                <option value="all">All Status</option>
                <option value="Scheduled">Scheduled</option>
                <option value="Confirmed">Confirmed</option>
                <option value="Completed">Completed</option>
                <option value="Cancelled">Cancelled</option>
              </select>
              <button class="btn btn-outline" onclick="clearAppointmentFilters();" style="padding:8px 16px;font-size:0.85rem;">
                <i class="fas fa-times"></i> Clear
              </button>
            </div>
          </div>
          <div class="dashboard-card">
            <div style="overflow-x:auto;">
              <table class="data-table" id="appointmentsTable">
                <thead><tr><th>Patient</th><th>Date</th><th>Time</th><th>Service</th><th>Payment</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- TAB: Calendar View - Calendly Style -->
        <div id="tab-calendar" class="tab-content" style="display:none;">
          <div class="calendly-container">
            <!-- Left: Mini Calendar -->
            <div class="calendly-sidebar">
              <div class="mini-calendar-wrapper">
                <div class="mini-calendar-header">
                  <button onclick="changeMiniMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                  <h4 id="miniCalendarMonth">January 2025</h4>
                  <button onclick="changeMiniMonth(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="mini-calendar-days">
                  <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
                </div>
                <div class="mini-calendar-grid" id="miniCalendarGrid"></div>
              </div>
            </div>

            <!-- Center: Schedule Display -->
            <div class="calendly-main">
              <div class="schedule-header">
                <div class="schedule-nav">
                  <button onclick="navigateSchedule(-1)"><i class="fas fa-chevron-left"></i></button>
                  <h3 id="scheduleTitle">Today's Schedule</h3>
                  <button onclick="navigateSchedule(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <button class="btn btn-primary" onclick="goToToday()" style="padding:8px 16px;font-size:0.85rem;">
                  <i class="fas fa-calendar-day"></i> Today
                </button>
              </div>

              <div class="schedule-content" id="scheduleContent">
                <!-- Schedule rendered by JS -->
              </div>
            </div>

            <!-- Right: View Selector + Today's Summary -->
            <div class="calendly-right">
              <div class="view-selector">
                <button class="view-btn active" data-view="day" onclick="setCalendarView('day')">
                  <i class="fas fa-calendar-day"></i> Day
                </button>
                <button class="view-btn" data-view="week" onclick="setCalendarView('week')">
                  <i class="fas fa-calendar-week"></i> Week
                </button>
                <button class="view-btn" data-view="month" onclick="setCalendarView('month')">
                  <i class="fas fa-calendar"></i> Month
                </button>
              </div>

              <div class="today-summary">
                <h4><i class="fas fa-info-circle"></i> Today's Summary</h4>
                <div class="summary-item">
                  <span>Total Appointments</span>
                  <strong id="summaryTotal">0</strong>
                </div>
                <div class="summary-item">
                  <span>Completed</span>
                  <strong id="summaryCompleted">0</strong>
                </div>
                <div class="summary-item">
                  <span>Remaining</span>
                  <strong id="summaryRemaining">0</strong>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: Accounts -->
        <div id="tab-accounts" class="tab-content" style="display:none;">
          <!-- Accounts Header -->
          <div class="accounts-header-section">
            <div class="accounts-title">
              <h2><i class="fas fa-chart-line"></i> Accounts & Reports</h2>
              <p>Track revenue, payments, and generate reports</p>
            </div>
            <div class="accounts-header-actions">
              <button class="btn-icon-text" onclick="exportAccountsCSV()">
                <i class="fas fa-download"></i> Export
              </button>
            </div>
          </div>

          <!-- Revenue Summary Cards -->
          <div class="accounts-revenue-grid">
            <div class="revenue-card total">
              <div class="revenue-icon"><i class="fas fa-wallet"></i></div>
              <div class="revenue-info">
                <span class="revenue-amount" id="accountsRevenue">₹0</span>
                <span class="revenue-label">Total Revenue</span>
              </div>
            </div>
            <div class="revenue-card patients">
              <div class="revenue-icon"><i class="fas fa-user-check"></i></div>
              <div class="revenue-info">
                <span class="revenue-amount" id="accountsPatients">0</span>
                <span class="revenue-label">Patients Treated</span>
              </div>
            </div>
            <div class="revenue-card cash">
              <div class="revenue-icon"><i class="fas fa-money-bill-wave"></i></div>
              <div class="revenue-info">
                <span class="revenue-amount" id="accountsCash">₹0</span>
                <span class="revenue-label">Cash</span>
              </div>
            </div>
            <div class="revenue-card gpay">
              <div class="revenue-icon"><i class="fas fa-mobile-alt"></i></div>
              <div class="revenue-info">
                <span class="revenue-amount" id="accountsGPay">₹0</span>
                <span class="revenue-label">GPay</span>
              </div>
            </div>
            <div class="revenue-card card">
              <div class="revenue-icon"><i class="fas fa-credit-card"></i></div>
              <div class="revenue-info">
                <span class="revenue-amount" id="accountsCard">₹0</span>
                <span class="revenue-label">Card</span>
              </div>
            </div>
          </div>

          <!-- Report Tabs -->
          <div class="report-tabs-container">
            <div class="report-tabs">
              <button class="report-tab active" onclick="switchReportTab('daily')">
                <i class="fas fa-calendar-day"></i> Daily
              </button>
              <button class="report-tab" onclick="switchReportTab('weekly')">
                <i class="fas fa-calendar-week"></i> Weekly
              </button>
              <button class="report-tab" onclick="switchReportTab('monthly')">
                <i class="fas fa-calendar-alt"></i> Monthly
              </button>
            </div>
          </div>

          <!-- Daily Report View -->
          <div id="report-daily" class="report-view active">
            <div class="report-content-grid">
              <div class="report-panel">
                <div class="report-panel-header">
                  <h3><i class="fas fa-list-ul"></i> Today's Transactions</h3>
                  <input type="date" id="dailyReportDate" onchange="loadDailyReport()">
                </div>
                <div class="report-panel-body">
                  <table class="data-table compact" id="dailyTransactionsTable">
                    <thead><tr><th>Time</th><th>Patient</th><th>Service</th><th>Amount</th><th>Mode</th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="report-summary-panel">
                <h4>Daily Summary</h4>
                <div class="summary-item"><span>Total Appointments</span><strong id="dailyAppointments">0</strong></div>
                <div class="summary-item"><span>Completed</span><strong id="dailyCompleted">0</strong></div>
                <div class="summary-item"><span>Revenue</span><strong id="dailyRevenue" class="revenue">₹0</strong></div>
                <div class="summary-divider"></div>
                <div class="summary-item"><span>Cash</span><strong id="dailyCash">₹0</strong></div>
                <div class="summary-item"><span>GPay</span><strong id="dailyGPay">₹0</strong></div>
                <div class="summary-item"><span>Card</span><strong id="dailyCard">₹0</strong></div>
              </div>
            </div>
          </div>

          <!-- Weekly Report View -->
          <div id="report-weekly" class="report-view">
            <div class="report-content-grid">
              <div class="report-panel">
                <div class="report-panel-header">
                  <h3><i class="fas fa-chart-bar"></i> Weekly Overview</h3>
                  <div class="week-nav">
                    <button onclick="changeReportWeek(-1)"><i class="fas fa-chevron-left"></i></button>
                    <span id="weeklyReportLabel">This Week</span>
                    <button onclick="changeReportWeek(1)"><i class="fas fa-chevron-right"></i></button>
                  </div>
                </div>
                <div class="report-panel-body">
                  <div class="weekly-chart" id="weeklyChart"></div>
                  <table class="data-table compact" id="weeklyBreakdownTable">
                    <thead><tr><th>Day</th><th>Appointments</th><th>Revenue</th><th>Cash</th><th>GPay</th><th>Card</th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="report-summary-panel">
                <h4>Weekly Summary</h4>
                <div class="summary-item"><span>Total Appointments</span><strong id="weeklyAppointments">0</strong></div>
                <div class="summary-item"><span>Completed</span><strong id="weeklyCompleted">0</strong></div>
                <div class="summary-item"><span>Revenue</span><strong id="weeklyRevenue" class="revenue">₹0</strong></div>
                <div class="summary-divider"></div>
                <div class="summary-item"><span>Avg/Day</span><strong id="weeklyAvgRevenue">₹0</strong></div>
                <div class="summary-item"><span>Best Day</span><strong id="weeklyBestDay">-</strong></div>
              </div>
            </div>
          </div>

          <!-- Monthly Report View -->
          <div id="report-monthly" class="report-view">
            <div class="report-content-grid">
              <div class="report-panel">
                <div class="report-panel-header">
                  <h3><i class="fas fa-chart-pie"></i> Monthly Overview</h3>
                  <div class="month-nav">
                    <button onclick="changeReportMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                    <span id="monthlyReportLabel">This Month</span>
                    <button onclick="changeReportMonth(1)"><i class="fas fa-chevron-right"></i></button>
                  </div>
                </div>
                <div class="report-panel-body">
                  <div class="monthly-stats-grid">
                    <div class="monthly-stat-card">
                      <i class="fas fa-users"></i>
                      <strong id="monthlyPatients">0</strong>
                      <span>Patients</span>
                    </div>
                    <div class="monthly-stat-card">
                      <i class="fas fa-calendar-check"></i>
                      <strong id="monthlyAppointments">0</strong>
                      <span>Appointments</span>
                    </div>
                    <div class="monthly-stat-card">
                      <i class="fas fa-check-circle"></i>
                      <strong id="monthlyCompleted">0</strong>
                      <span>Completed</span>
                    </div>
                    <div class="monthly-stat-card revenue">
                      <i class="fas fa-indian-rupee-sign"></i>
                      <strong id="monthlyTotalRevenue">₹0</strong>
                      <span>Revenue</span>
                    </div>
                  </div>
                  <div class="payment-breakdown-visual" id="monthlyPaymentBreakdown"></div>
                </div>
              </div>
              <div class="report-summary-panel">
                <h4>Monthly Summary</h4>
                <div class="summary-item"><span>Cash</span><strong id="monthlyCash">₹0</strong></div>
                <div class="summary-item"><span>GPay</span><strong id="monthlyGPay">₹0</strong></div>
                <div class="summary-item"><span>Card</span><strong id="monthlyCard">₹0</strong></div>
                <div class="summary-divider"></div>
                <div class="summary-item"><span>Avg/Week</span><strong id="monthlyAvgWeek">₹0</strong></div>
                <div class="summary-item"><span>Best Week</span><strong id="monthlyBestWeek">-</strong></div>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: Trash (Deleted Patients) -->
        <div id="tab-trash" class="tab-content" style="display:none;">
          <div class="dashboard-card-header" style="margin-bottom:24px;">
            <div>
              <h2 style="font-size:1.8rem;"><i class="fas fa-trash-alt" style="margin-right:10px;opacity:0.7;"></i>Trash</h2>
              <p style="color:var(--text-muted);font-size:0.9rem;margin-top:8px;">Deleted patients are kept here for 30 days before permanent deletion.</p>
            </div>
            <button class="btn btn-outline" onclick="emptyTrash()" style="padding:8px 16px;font-size:0.85rem;color:#DC2626;border-color:#DC2626;">
              <i class="fas fa-trash"></i> Empty Trash
            </button>
          </div>
          <div class="dashboard-card">
            <div style="overflow-x:auto;">
              <table class="data-table" id="trashTable">
                <thead><tr><th>Name</th><th>Age</th><th>Phone</th><th>Deleted On</th><th>Auto-Delete In</th><th>Actions</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- TAB: Settings / Cloud Sync -->
        <div id="tab-settings" class="tab-content" style="display:none;">
          <div class="dashboard-card-header" style="margin-bottom:24px;">
            <div>
              <h2 style="font-size:1.8rem;"><i class="fas fa-cloud" style="margin-right:10px;opacity:0.7;"></i>Cloud Sync &amp; Data</h2>
              <p style="color:var(--text-muted);font-size:0.9rem;margin-top:8px;">Sync your data across all browsers and devices using Firebase. Your data will be available on any browser when you open the site.</p>
            </div>
          </div>

          <!-- Sync Status Card -->
          <div class="dashboard-card" style="margin-bottom:20px;">
            <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;">
              <div>
                <h3 style="font-size:1.1rem;margin-bottom:4px;">Sync Status</h3>
                <div id="syncStatusDisplay" style="font-size:0.9rem;color:var(--text-muted);">
                  <span id="syncStatusIndicator2"></span>
                </div>
              </div>
              <div style="display:flex;gap:10px;flex-wrap:wrap;">
                <button class="btn btn-primary" onclick="syncNowFromCloud()" style="padding:8px 16px;font-size:0.85rem;">
                  <i class="fas fa-cloud-download-alt"></i> Pull from Cloud
                </button>
                <button class="btn btn-secondary" onclick="syncNowToCloud()" style="padding:8px 16px;font-size:0.85rem;">
                  <i class="fas fa-cloud-upload-alt"></i> Push to Cloud
                </button>
              </div>
            </div>
          </div>

          <!-- Data Stats Card -->
          <div class="dashboard-card" style="margin-bottom:20px;">
            <h3 style="font-size:1.1rem;margin-bottom:16px;"><i class="fas fa-database" style="margin-right:8px;opacity:0.7;"></i>Local Data Statistics</h3>
            <div id="dataStatsGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;"></div>
          </div>

          <!-- Export/Import Card -->
          <div class="dashboard-card" style="margin-bottom:20px;">
            <h3 style="font-size:1.1rem;margin-bottom:8px;"><i class="fas fa-exchange-alt" style="margin-right:8px;opacity:0.7;"></i>Export / Import Data</h3>
            <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:16px;">Transfer data between browsers manually using a JSON file. Export from one browser and import in another.</p>
            <div style="display:flex;gap:12px;flex-wrap:wrap;">
              <button class="btn btn-primary" onclick="CloudSync.exportData()" style="padding:10px 20px;font-size:0.85rem;">
                <i class="fas fa-download"></i> Export All Data
              </button>
              <label class="btn btn-secondary" style="padding:10px 20px;font-size:0.85rem;cursor:pointer;">
                <i class="fas fa-upload"></i> Import Data
                <input type="file" accept=".json" onchange="handleImportFile(this)" style="display:none;">
              </label>
            </div>
          </div>

          <!-- Firebase Setup Card -->
          <div class="dashboard-card" style="margin-bottom:20px;">
            <h3 style="font-size:1.1rem;margin-bottom:8px;"><i class="fas fa-cog" style="margin-right:8px;opacity:0.7;"></i>Firebase Cloud Setup</h3>
            <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:16px;">Connect to Firebase Realtime Database for automatic cross-browser sync. Follow the steps below to set up.</p>

            <div style="background:rgba(27,77,62,0.04);padding:16px;border-radius:var(--radius);border:1px solid rgba(27,77,62,0.1);margin-bottom:20px;">
              <h4 style="font-size:0.9rem;color:var(--primary);margin-bottom:12px;">Setup Steps:</h4>
              <ol style="font-size:0.85rem;color:var(--text-muted);padding-left:20px;line-height:2;">
                <li>Go to <a href="https://console.firebase.google.com/" target="_blank" style="color:var(--primary);text-decoration:underline;">Firebase Console</a> and create a new project (free)</li>
                <li>In your project, go to <strong>Build &gt; Realtime Database</strong> and click <strong>Create Database</strong></li>
                <li>Choose <strong>"Start in test mode"</strong> for the security rules</li>
                <li>Go to <strong>Project Settings</strong> (gear icon) &gt; <strong>General</strong> &gt; scroll down to <strong>"Your apps"</strong></li>
                <li>Click the <strong>Web (&lt;/&gt;)</strong> icon to add a web app</li>
                <li>Copy the <strong>firebaseConfig</strong> values and paste them below</li>
              </ol>
            </div>

            <form onsubmit="event.preventDefault(); saveFirebaseConfig();" id="firebaseConfigForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="fbApiKey">API Key *</label>
                  <input type="text" id="fbApiKey" placeholder="AIzaSy..." required>
                </div>
                <div class="form-group">
                  <label for="fbAuthDomain">Auth Domain *</label>
                  <input type="text" id="fbAuthDomain" placeholder="your-project.firebaseapp.com" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="fbDatabaseURL">Database URL *</label>
                  <input type="text" id="fbDatabaseURL" placeholder="https://your-project-default-rtdb.firebaseio.com" required>
                </div>
                <div class="form-group">
                  <label for="fbProjectId">Project ID *</label>
                  <input type="text" id="fbProjectId" placeholder="your-project-id" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="fbStorageBucket">Storage Bucket</label>
                  <input type="text" id="fbStorageBucket" placeholder="your-project.appspot.com">
                </div>
                <div class="form-group">
                  <label for="fbMessagingSenderId">Messaging Sender ID</label>
                  <input type="text" id="fbMessagingSenderId" placeholder="123456789">
                </div>
              </div>
              <div class="form-group">
                <label for="fbAppId">App ID</label>
                <input type="text" id="fbAppId" placeholder="1:123456789:web:abcdef">
              </div>
              <div style="display:flex;gap:12px;margin-top:16px;">
                <button type="submit" class="btn btn-primary" style="padding:10px 24px;font-size:0.85rem;">
                  <i class="fas fa-link"></i> Connect Firebase
                </button>
                <button type="button" class="btn btn-outline" onclick="disconnectFirebase()" style="padding:10px 24px;font-size:0.85rem;color:#DC2626;border-color:#DC2626;">
                  <i class="fas fa-unlink"></i> Disconnect
                </button>
              </div>
            </form>
          </div>
        </div>

      </main>
    </div>
  </div>

  <!-- Add Patient Modal -->
  <div class="modal-overlay" id="addPatientModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('addPatientModal')"><i class="fas fa-times"></i></button>
      <h2>Add New Patient</h2>
      <form onsubmit="addPatient(event)">
        <div class="form-group">
          <label for="ptName">Full Name *</label>
          <input type="text" id="ptName" required placeholder="Patient full name">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="ptAge">Age *</label>
            <input type="number" id="ptAge" required min="1" max="120" placeholder="Age">
          </div>
          <div class="form-group">
            <label for="ptGender">Gender *</label>
            <select id="ptGender" required>
              <option value="">Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="ptPhone">Phone *</label>
          <input type="tel" id="ptPhone" required placeholder="Phone number">
        </div>
        <div class="form-group">
          <label for="ptEmail">Email</label>
          <input type="email" id="ptEmail" placeholder="Email address (optional)">
        </div>
        <div class="form-group">
          <label for="ptAddress">Address</label>
          <textarea id="ptAddress" rows="3" placeholder="Full address"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center;">
          <i class="fas fa-save"></i> Save Patient
        </button>
      </form>
    </div>
  </div>

  <!-- View Patient Modal -->
  <div class="modal-overlay" id="viewPatientModal">
    <div class="modal" style="max-width:750px;">
      <button class="modal-close" onclick="closeModal('viewPatientModal')"><i class="fas fa-times"></i></button>
      <h2>Patient Details</h2>
      <div id="patientDetails" style="margin-bottom:24px;"></div>
      <h3 id="viewModalSubtitle" style="font-size:1.1rem;margin-bottom:12px;">Treatment History</h3>
      <div id="visitHistory" style="margin-bottom:24px;max-height:300px;overflow-y:auto;"></div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn btn-primary" id="btnWriteRx" style="padding:10px 20px;font-size:0.85rem;">
          <i class="fas fa-file-prescription"></i> Write Prescription
        </button>
        <button class="btn btn-accent" id="btnBookAppt" style="padding:10px 20px;font-size:0.85rem;">
          <i class="fas fa-calendar-plus"></i> Book Appointment
        </button>
        <button class="btn btn-whatsapp" id="btnPatientWa" style="padding:10px 20px;font-size:0.85rem;">
          <i class="fab fa-whatsapp"></i> WhatsApp
        </button>
      </div>
    </div>
  </div>

  <!-- Write Prescription Modal -->
  <div class="modal-overlay" id="prescriptionModal">
    <div class="modal" style="max-width:650px;">
      <button class="modal-close" onclick="closeModal('prescriptionModal')"><i class="fas fa-times"></i></button>
      <h2>Write Prescription</h2>
      <p style="color:var(--primary);font-weight:600;margin-bottom:20px;" id="rxPatientName"></p>
      <form onsubmit="savePrescription(event)">
        <input type="hidden" id="rxPatientId">
        <div class="form-group">
          <label for="rxDiagnosis">Diagnosis *</label>
          <textarea id="rxDiagnosis" rows="3" required placeholder="Primary diagnosis and findings..."></textarea>
        </div>
        <div class="form-group">
          <label for="rxTreatment">Treatment Plan *</label>
          <textarea id="rxTreatment" rows="3" required placeholder="Treatment protocol, modalities, frequency..."></textarea>
        </div>
        <div class="form-group">
          <label for="rxMedications">Medications</label>
          <textarea id="rxMedications" rows="3" placeholder="Medicines, dosage, duration..."></textarea>
        </div>
        <div class="form-group">
          <label for="rxInstructions">Instructions</label>
          <textarea id="rxInstructions" rows="3" placeholder="Home exercises, precautions, lifestyle changes..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="rxFollowupDate">Follow-up Date (optional)</label>
            <input type="date" id="rxFollowupDate">
          </div>
          <div class="form-group">
            <label for="rxFollowupReason">Follow-up Reason</label>
            <input type="text" id="rxFollowupReason" placeholder="Reason for follow-up">
          </div>
        </div>
        <div class="payment-section" style="margin-top:20px;padding-top:20px;border-top:1px solid var(--border-light);">
          <h4 style="font-size:0.95rem;font-weight:600;margin-bottom:12px;color:var(--primary);"><i class="fas fa-indian-rupee-sign" style="margin-right:6px;"></i>Payment Collection</h4>
          <div class="form-row">
            <div class="form-group">
              <label for="rxPaymentAmount">Amount (₹)</label>
              <input type="number" id="rxPaymentAmount" placeholder="0" min="0">
            </div>
            <div class="form-group">
              <label for="rxPaymentMode">Payment Mode</label>
              <select id="rxPaymentMode">
                <option value="">Not Collected</option>
                <option value="Cash">Cash</option>
                <option value="GPay">GPay</option>
                <option value="Card">Card</option>
              </select>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:16px;">
          <button type="submit" class="btn btn-primary" style="flex:1;justify-content:center;">
            <i class="fas fa-save"></i> Save Prescription
          </button>
          <button type="button" class="btn btn-accent" onclick="saveAndPrintPrescription()" style="flex:1;justify-content:center;">
            <i class="fas fa-print"></i> Print Prescription
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Schedule Follow-up Modal -->
  <div class="modal-overlay" id="followupModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('followupModal')"><i class="fas fa-times"></i></button>
      <h2>Schedule Follow-up</h2>
      <p style="color:var(--primary);font-weight:600;margin-bottom:20px;" id="fuPatientName"></p>
      <form onsubmit="saveFollowup(event)">
        <input type="hidden" id="fuPatientId">
        <div class="form-group">
          <label for="fuDate">Follow-up Date *</label>
          <input type="date" id="fuDate" required>
        </div>
        <div class="form-group">
          <label for="fuReason">Reason *</label>
          <input type="text" id="fuReason" required placeholder="Reason for follow-up">
        </div>
        <div class="form-group">
          <label for="fuNotes">Notes</label>
          <textarea id="fuNotes" rows="3" placeholder="Additional notes..."></textarea>
        </div>
        <div class="form-group" style="display:flex;align-items:center;gap:8px;">
          <input type="checkbox" id="fuCreateAppointment" checked style="width:auto;">
          <label for="fuCreateAppointment" style="margin:0;font-size:0.88rem;">Also create an appointment for this date</label>
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center;">
          <i class="fas fa-calendar-plus"></i> Schedule Follow-up
        </button>
      </form>
    </div>
  </div>

  <!-- Quick Booking Modal (Doctor) with Duration & Payment -->
  <div class="modal-overlay" id="quickBookingModal">
    <div class="modal" style="max-width:550px;">
      <button class="modal-close" onclick="closeModal('quickBookingModal')"><i class="fas fa-times"></i></button>
      <h2>Book Appointment</h2>
      <p style="color:var(--primary);font-weight:600;margin-bottom:20px;" id="qbPatientName"></p>
      <form onsubmit="saveQuickBooking(event)">
        <input type="hidden" id="qbPatientId">
        <div class="form-group">
          <label for="qbDate">Appointment Date *</label>
          <input type="date" id="qbDate" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="qbStartTime">Start Time *</label>
            <select id="qbStartTime" required onchange="updateEndTimeOptions()">
              <optgroup label="Morning (10 AM - 1:30 PM)">
                <option value="10:00 AM">10:00 AM</option>
                <option value="10:15 AM">10:15 AM</option>
                <option value="10:30 AM">10:30 AM</option>
                <option value="10:45 AM">10:45 AM</option>
                <option value="11:00 AM">11:00 AM</option>
                <option value="11:15 AM">11:15 AM</option>
                <option value="11:30 AM">11:30 AM</option>
                <option value="11:45 AM">11:45 AM</option>
                <option value="12:00 PM">12:00 PM</option>
                <option value="12:15 PM">12:15 PM</option>
                <option value="12:30 PM">12:30 PM</option>
                <option value="12:45 PM">12:45 PM</option>
                <option value="1:00 PM">1:00 PM</option>
                <option value="1:15 PM">1:15 PM</option>
              </optgroup>
              <optgroup label="Evening (6 PM - 8:30 PM)">
                <option value="6:00 PM">6:00 PM</option>
                <option value="6:15 PM">6:15 PM</option>
                <option value="6:30 PM">6:30 PM</option>
                <option value="6:45 PM">6:45 PM</option>
                <option value="7:00 PM">7:00 PM</option>
                <option value="7:15 PM">7:15 PM</option>
                <option value="7:30 PM">7:30 PM</option>
                <option value="7:45 PM">7:45 PM</option>
                <option value="8:00 PM">8:00 PM</option>
                <option value="8:15 PM">8:15 PM</option>
              </optgroup>
            </select>
          </div>
          <div class="form-group">
            <label for="qbDuration">Duration *</label>
            <select id="qbDuration" required onchange="updateEndTimeFromDuration()">
              <option value="15">15 minutes</option>
              <option value="30" selected>30 minutes</option>
              <option value="45">45 minutes</option>
              <option value="60">1 hour</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="qbEndTime">End Time</label>
          <input type="text" id="qbEndTime" readonly style="background:var(--bg);">
        </div>
        <div class="form-group">
          <label for="qbService">Service *</label>
          <select id="qbService" required>
            <option value="">Select Service</option>
            <option value="General Consultation">General Consultation</option>
            <option value="Fascial Manipulation">Fascial Manipulation</option>
            <option value="Orthopedic Rehabilitation">Orthopedic Rehabilitation</option>
            <option value="Neuro Rehabilitation">Neuro Rehabilitation</option>
            <option value="Women's Health Physio">Women's Health Physio</option>
            <option value="Elderly Home Care">Elderly Home Care</option>
            <option value="Pediatric Physiotherapy">Pediatric Physiotherapy</option>
            <option value="Follow-up">Follow-up Visit</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="qbPaymentAmount">Payment Amount (₹)</label>
            <input type="number" id="qbPaymentAmount" placeholder="0" min="0">
          </div>
          <div class="form-group">
            <label for="qbPaymentStatus">Payment Status</label>
            <select id="qbPaymentStatus">
              <option value="Pending">Pending</option>
              <option value="Paid">Paid</option>
              <option value="Partial">Partial</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="qbPaymentMode">Payment Mode</label>
          <select id="qbPaymentMode">
            <option value="">Not Collected</option>
            <option value="Cash">Cash</option>
            <option value="GPay">GPay</option>
            <option value="Card">Card</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center;">
          <i class="fas fa-calendar-check"></i> Book Appointment
        </button>
      </form>
    </div>
  </div>

  <!-- Complete Treatment Modal (for completing appointments) -->
  <div class="modal-overlay" id="treatmentModal">
    <div class="modal" style="max-width:550px;">
      <button class="modal-close" onclick="closeModal('treatmentModal')"><i class="fas fa-times"></i></button>
      <h2><i class="fas fa-check-circle" style="color:var(--primary);margin-right:8px;"></i>Complete Treatment</h2>

      <div style="background:var(--bg);padding:16px;border-radius:var(--radius);margin-bottom:20px;">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.9rem;">
          <div><strong>Patient:</strong> <span id="treatmentPatientName">-</span></div>
          <div><strong>Service:</strong> <span id="treatmentService">-</span></div>
          <div><strong>Date:</strong> <span id="treatmentDate">-</span></div>
          <div><strong>Scheduled:</strong> <span id="treatmentScheduledTime">-</span></div>
        </div>
      </div>

      <form onsubmit="event.preventDefault(); saveCompletedTreatment();">
        <div class="form-row">
          <div class="form-group">
            <label for="treatmentActualStart">Actual Start Time</label>
            <input type="time" id="treatmentActualStart">
          </div>
          <div class="form-group">
            <label for="treatmentActualEnd">Actual End Time</label>
            <input type="time" id="treatmentActualEnd">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="treatmentAmountPaid">Amount Collected (₹)</label>
            <input type="number" id="treatmentAmountPaid" placeholder="500" min="0">
          </div>
          <div class="form-group">
            <label for="treatmentPaymentStatus">Payment Status</label>
            <select id="treatmentPaymentStatus">
              <option value="Paid">Paid</option>
              <option value="Pending">Pending</option>
              <option value="Partial">Partial</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="treatmentPaymentMode">Payment Mode</label>
          <select id="treatmentPaymentMode">
            <option value="">Select Mode</option>
            <option value="Cash">Cash</option>
            <option value="GPay">GPay</option>
            <option value="Card">Card</option>
          </select>
        </div>
        <div class="form-group">
          <label for="treatmentNotes">Treatment Notes</label>
          <textarea id="treatmentNotes" rows="3" placeholder="Notes about the treatment session..."></textarea>
        </div>
        <div style="display:flex;gap:12px;margin-top:20px;">
          <button type="submit" class="btn btn-primary" style="flex:1;justify-content:center;">
            <i class="fas fa-check"></i> Complete Treatment
          </button>
          <button type="button" class="btn btn-whatsapp" onclick="completeAndSendWhatsApp()" style="justify-content:center;">
            <i class="fab fa-whatsapp"></i> Complete & WhatsApp
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast"><span id="toastMessage"></span></div>

  <a href="https://wa.me/919092294466" target="_blank" class="whatsapp-float">
    <i class="fab fa-whatsapp"></i>
  </a>

  <!-- Firebase SDK (for cross-browser cloud sync) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

  <script src="js/main.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/cloud-sync.js"></script>
  <script src="js/pwa.js"></script>
</body>
</html>
